<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>회원 정보</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css"
        integrity="sha512-3pIirOrwegjM6erE5gPSwkUzO+3cTjpnV9lexlNZqvupR64iZBnOOTiiLPb9M36zpMScbmUNIcHUqKD47M719g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script th:replace="fragments/tailwind-config-head :: script"></script>
  <style>

    article {
      font-family: Arial, sans-serif;
      margin-top: 5%;
      margin-bottom: 10%;
    }

    #title {
      width: 30%;
      height: 10%;
      font-size: 30px;
      margin-right: 0;
    }

    form {
      max-width: 350px;
      margin: 0 auto;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }

    input[type="text"],
    input[type="password"],
    input[type="email"],
    input[type="tel"],
    input[type="datetime-local"],
    input[type="checkbox"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      margin-bottom: 3px;
    }

    input[type="submit"] {
      background-color: #4CAF50;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    label {
      padding-top: 20px;
    }

    input[type="submit"]:hover {
      background-color: #45a049;
      width: 100%;
    }

  </style>
</head>
<body>
<header th:replace="fragments/header :: header"></header>
<hr>
<aside class="main-sidebar col-12 col-md-3 col-lg-2 px-0">
  <div th:if="${session.role == 'ADMIN'}">
    <ul>
      <li><a th:href="@{/users}">회원 리스트</a></li>
      <!--      <li><a th:href="@{/wish}">위시 리스트</a></li>-->
    </ul>
  </div>
</aside>
<article>
  <div style="text-align: center; width: 50%">
    <span id="title">회원 리스트</span>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
      <tr style="background-color: #f2f2f2;">
        <th style="padding: 10px; border: 1px solid #ddd;">닉네임</th>
        <th style="padding: 10px; border: 1px solid #ddd;">위시보기</th>
        <th style="padding: 10px; border: 1px solid #ddd;">블락여부</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="user,userStat : ${users}">
        <td style="padding: 10px; border: 1px solid #ddd;" th:text="${user.nickname}"></td>
        <td style="padding: 10px; border: 1px solid #ddd;" th:text="위시보기" th:href="@{/users/}"></td>
        <td style="padding: 10px; border: 1px solid #ddd;">
          <button style="padding: 5px 10px; border: none; cursor: pointer;"
                  th:style="${'background-color: ' + (user.isBlock ? '#f44336' : '#4CAF50')}"
                  th:onclick="'blockUser(' + ${user.id} +',' + ${userStat.index}  + ')'"
                  th:id="'blockButton-' + ${userStat.index}">
            <span th:id="'blockSpan-' + ${userStat.index}" th:text="${user.isBlock ? '블락 됨' : '블락 안 됨'}" style="color: white;"></span>
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</article>

<footer th:replace="fragments/footer :: footer"></footer>
<script>
  function blockUser(id,index) {
    $.ajax({
      url: '/users/' + id + '/block',
      type: 'get', //POST 방식으로 전달
      success: function (blockUserResponse) {
        if (!blockUserResponse.updated) {
          toastr.error('관리자를 블락할 수 없습니둥');
        } else {
          var button = document.querySelector('#blockButton-' + index);
          var span = document.querySelector('#blockSpan-' + index);
          if (blockUserResponse.userBlocked) {
            button.style.backgroundColor = '#f44336';
            span.textContent = '블락 됨';
            toastr.success("블락 성공");
          } else if (!blockUserResponse.userBlocked) {
            button.style.backgroundColor = '#4CAF50';
            span.textContent = '블락 안 됨';
            toastr.success("블락 해제");
          }
        }
      },
      error: function () {
        alert("에러입니다");
      }
    })
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"
        integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>
</html>
